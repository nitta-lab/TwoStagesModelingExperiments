<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>手動課題A1</title>
</head>
<style>
    .image_size{
        width: 600px;
        height: 400px;
    }
</style>
<body>

<h1>課題1-(1)の概要</h1>

<p>
    この Map プログラムでは，GPSの位置情報が更新されるたびに，それに合わせて地図の表示位置も自動で更新されます．しかしながら，地図アプリのユーザはいつでも自分の周辺の地図を閲覧したいわけではありません．
    例えば，電車に乗りながら目的地周辺の地図情報を確認したい場合，電車の動きに合わせて地図の表示位置が勝手に動いてしまうと困ります．<br>
    そこで，GPSに合わせて地図の表示位置を自動更新するか否かを切り替えられる機能(自動更新のON/OFF機能)を追加することを考えます．
    この機能では自動更新をいつでもON/OFFすることができ，自動更新がONのときは常にGPSの位置情報と地図の表示位置が連動するようにし，OFFのときはGPSの位置情報が更新されても地図の表示位置が変わらないようにします．
    また手動更新ボタンを用意し，自動更新がOFFのときでもこのボタンが押されると，その時点でのGPSの位置情報が地図の表示位置に反映されるようにします．
</p>
<p>
    現在の設計では，以下のクラス図のようにGPSの緯度情報を保持している <code>Latitude</code> オブジェクトが地図の中心位置の緯度成分を表す <code>MapLatitude</code> オブジェクトを，
    GPSの経度情報を保持している <code>Longitude</code> オブジェクトが地図の中心位置の経度成分を表す <code>MapLongitude</code> オブジェクトをそれぞれ更新するようになっています．<br>
</p>
<img src="../img/classes/clock_class_push.png", class ="image_size"><br>
<p>
    具体的には以下のコードのように，GPSの位置情報の変化をセンサーが検知するたびに <code>Map</code> クラスの <code>updateGPS()</code> メソッドが呼び出され，
    その中から <code>Longitude</code> クラスの <code>updateGPS()</code> メソッドと <code>Latitude</code> クラスの <code>updateGPS()</code> メソッドが呼ばれて，まずGPSの緯度と経度の情報が更新されます．
</p>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<pre class="brush:java; gutter:false" id="A">
public class Map {
	  :
	private Longitude longitude;
	private Latitude latitude;
	  :
	public void updateGPS(double lat2, double long2) {
		this.longitude.updateGPS(lat2, long2);
		this.latitude.updateGPS(lat2, long2);
	}
	  :
}
</pre>
</div>
<p>
    そして，それらのメソッドの中からさらに，<code>MapLongitude</code> クラスの <code>updateLongitude()</code> メソッドと
    <code>MapLatitude</code> クラスの <code>updateLatitude()</code> メソッドが以下のコードのようにそれぞれ呼ばれて，引き続き地図の中心位置の情報も更新されます．
	これらの更新は常に連続して行われるため，このままの設計では，GPSの位置情報だけを更新して地図の中心位置は更新しないという，自動更新がOFFの状態の振る舞いを上手く実装することができません．
</p>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<pre class="brush:java; gutter:false" id="B">
public class Longitude {
	private MapLongitude mapLongitude;
	private double value;
	  :
	public void updateGPS(double lat2, double long2) {
		this.value = long2;
		this.mapLongitude.updateLongitude(this.value);
	}
}

public class Latitude {
	private MapLatitude mapLatitude;
	private double value;
	  :
	public void updateGPS(double lat2, double long2) {
		this.value = lat2;
		this.mapLatitude.updateLatitude(this.value);
	}
}
</pre>
</div>
<p>
    そこで，以下のクラス図のように新たに <code>Presenter</code> オブジェクトを導入し，<code>Longitude</code> オブジェクトも <code>Latitude</code> オブジェクトも，
    必ずこのオブジェクトを経由して <code>MapLatitude</code> オブジェクトや <code>MapLongitude</code> オブジェクトを更新するように設計変更を行います．
    そうすることによって，<code>Longitude</code> オブジェクトや <code>Latitude</code> オブジェクトの状態の更新後に
    <code>MapLatitude</code> オブジェクトや <code>MapLongitude</code> オブジェクトの状態の更新をするか否かを，<code>Presenter</code> オブジェクト上で制御することができるようになります．
</p>
<img src="../img/classes/clock_class_push_CFD.png", class ="image_size"><br>
<p>
    具体的に変更後の設計の中では，以下のように <code>Map</code> クラスの <code>updateGPS()</code> メソッドは，
    <code>Longitude</code> クラスと <code>Latitude</code> クラスの <code>updateGPS()</code> メソッドの代わりに <code>Presenter</code> クラスの <code>updateGPS()</code> メソッドを呼び出すようにします．
</p>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<pre class="brush:java; gutter:false" id="A">
public class Map {
	  :
	private Presenter presenter;
	  :
	public void updateGPS(double lat2, double long2) {
		this.presenter.updateGPS(lat2, long2);
	}
}
</pre>
</div>
<p>
    そして，<code>Presenter</code> クラスの <code>updateGPS()</code> メソッドは，
    <code>Longitude</code> オブジェクトや <code>Latitude</code> オブジェクトの状態の更新と，
    <code>MapLatitude</code> オブジェクトや <code>MapLongitude</code> オブジェクトの状態の更新を，以下のように切り離して実行するようにします．
    そのため，この <code>updateGPS()</code> メソッドを書き換えることによって，自動更新のON/OFFを制御することができるようになります．
</p>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<pre class="brush:java; gutter:false" id="B">
public class Presenter {
	private Longitude longitude;
	private Latitude latitude;
	private MapLongitude mapLongitude;
	private MapLatitude mapLatitude;
	  :
	public void updateGPS(double lat2, double long2) {
		double longitude = this.longitude.updateGPS(lat2, long2);
		double latitude = this.latitude.updateGPS(lat2, long2);
		this.mapLongitude.updateLongitude(longitude);
		this.mapLatitude.updateLatitude(latitude);
	}
}</pre>
</div>

<div class="links-manual-A">
<a href="https://docs.google.com/forms/d/e/1FAIpQLSf9q6nV6QeOgQoArCy-0TUx2xGHWhABn8hiLAHsFOyBpFAWIw/viewform?usp=sharing" target="_blank">
    アンケート回答
</a>

<a href="OperationA1.html">課題1-(2)の操作説明へ</a>
</div>
</body>
</html>

<style>
.links-manual-A{
    display: flex;
    flex-direction: column;
}
</style>